Title:		Release notes for FCS Release of 4.1.1
Created By:	Aravind Vigneshwar, Sachchit

============================================================================================================

This FCS build is based on the ArduCopter 4.1.1 release. Release notes for the same can be found here. 
This document includes highlights of custom changes done over and above 4.1.1 for specific GA functionality.

============================================================================================================

GA Copter 4.1.1 v7
------------------------------------------------------------------------------------------------------------
Functionality:
1. Bug in the redundant GPS code is fixed. The bug used to give false alarm near Yaw = 0 and just after Takeoff
	and just before land.
2. If pilot don't react after warning to switch to althold and issues persist, the vehicle will trigger failsafe.
	This will result in aircraft to land. Parameter to control time to trigger failsafe is GPS_MSG_TMOUT_FS.
3. Parameter file version control is changed to .param file rather than .json file


GA Copter 4.1.1 v6
------------------------------------------------------------------------------------------------------------
Functionality:
1. Warning notifications are shown whenever no or redundant GPS data is obtained. 
	Data is considered redundant if latitude or longitude or Altitude or Heading or Velocity(Horizontal & Vertical)
	messages from the GPS do not change continuously for "GPS_MSG_TIMEOUT" seconds.
	Therefore,
		If [latitude or longitude or Altitude] is redundant, then "Switch to AltHold: GPSpos timeout" is shown in GCS
		If [Horizontal or Vertical velocities] is redundant, then "Switch to AltHold: GPSvel timeout" is shown in GCS
		If [GPS Heading] 					   is redundant, then "Switch to AltHold: GPSyaw timeout" is shown in GCS
	Note: "GPS_MSG_TIMEOUT" : The timeout duration that defines a redundant-GPS-message.
							  Range is [0.5,10]seconds.
2. Added prearm check for GPS yaw data.
	If GPS yaw data does not change continuously (i.e. is redundant) for more than 3 seconds, 
	then vehicle arming will be denied.
		Note: This check has to be enabled by checking "GPS lock" bitmask under "ARMING_CHECK" parameter.
3. Modified a logic used in "limiting I-gains during Takeoff" functionality.
	For limiting the gain to zero, the [land_complete] status of the vehicle is used, instead of using 
	[EKF_altitude = 0 approximately].

Controls:
1. Added Notch and Harmonic Notch filtering of Accelerometer data (earlier was available only to Gyro).
	Note: Filtering of accelerometer data is done at the same frequencies as in Gyro, 
		  and is enabled using the parameter,
			"INS_ACC_NOTCH_EN" : =0 disables functionality; =1 enables functionality

(Now, Parameter list file is included as a part of the "ArduCopter" folder)


GA Copter 4.1.1 v5
------------------------------------------------------------------------------------------------------------
Functionality:
1. In GPS-dependent modes (viz. Auto, Loiter, Guided), vehicle now arms only if "GPS RTX fix" is available
   	i.e. the system checks for GPS status '5' for arming the vehicle.
		Note: This check has to be enabled by checking "GPS lock" bitmask under "ARMING_CHECK" parameter.
2. Added CC Failsafe.
	i.e. When trying to Arm, if Companion Computer's heartbeat is not detected (within the last 2 seconds), 
							 ArduCopter voids the arm command.
		 After Arming,    	 if Companion Computer's heartbeat is not detected (for FS_CC_TIMEOUT seconds), 
		 					 ArduCopter triggers RTL.
	Note: Enabled using parameters,
			"FS_CC_ENABLE"  : =0 disables failsafe; =1 enables failsafe
			"FS_CC_TIMEOUT" : Without CC heartbeat, FCS waits this long to trigger the failsafe.
							  Range is [1,60]seconds.
3. During Takeoff, the I-gains of the Pitch & Roll rate-controller are made zero 
	(thus, preventing error accumulation until after take-off).
	Note: Enabled using parameters,
			"TKOFF_IGL_ENABLE" : =0 disables functionality; =1 enables functionality
			"TKOFF_IGL_ALTMAX" : After arming, only until this altitude, the I-gains are made zero.
								 After attaining this height above the arming point, the gains revert back.
							  	 Range is [10,300]cm.
4. Modified the "NPNT not Initialized" message to "Awaiting arming clearance from CC".
5. Following MAVLink messages added (in the MAVLink submodule currently linked to GA’s MAVLink repo):
	a. Message ID = 7004; Name = GA_COMMAND
	b. Message ID = 7005; Name = GA_COMMAND_ACK

Controls:
1. New CA04 frame types added: 
	a. FRAME_TYPE = 21 : CA04 (non-CG Corrected) airframe
	b. FRAME_TYPE = 22 : CA04 (non-CG Corrected) airframe with Yaw factors of Motors-1 & 2 reduced to 75%
	c. FRAME_TYPE = 23 : CA04 (non-CG Corrected) airframe with Yaw factors of Motors-1 & 2 reduced to 50%
	d. FRAME_TYPE = 24 : CA04 (non-CG Corrected) airframe with Yaw factors of Motors-1 & 2 reduced to 0%


GA Copter 4.1.1 v4
------------------------------------------------------------------------------------------------------------
Functionality:
1. With EKF3 Yaw source set as GPS, the GCS gets flooded with "EKF3 IMUx Initialised" messages until a valid
	GPSyaw is obtained. 
	This message now appears only for the first time and later, every 2seconds.
2. Added (mavlink) handling of GA_GET_PARAM request from Companion-Computer.
	Currently handles requests for:
		a. "PXHWK_ID": the Pixhawk/Cube board's serial no.
3. Added (mavlink) handling of GA_SET_PARAM request from Companion-Computer.
	Currently only this function structure is defined.
4. Following MAVLink messages added (in the MAVLink submodule currently linked to GA’s MAVLink repo):
	a. Message ID = 7001; Name = GA_SET_PARAM
	b. Message ID = 7002; Name = GA_GET_PARAM
	c. Message ID = 7003; Name = GA_PARAM
5. The mavlink "MAV_CMD_NAV_WAYPOINT" message parameters param2, param3 & param4 can now be utilized.
	These parameters are allocated 1byte each, and are of Integer datatype, so they take values between -127 & 128.
		Note: The size of the each mission item had to be increased (to 18bytes from 15bytes) as a result, therefore
		the maximum number of mission items that can be uploaded/stored is now limited to 
			a. CubeBlack: ~540
			b. CubeOrange: ~1080

Controls:
1. Landing using Rangefinder in modes Land, RTL & Auto to track the proper local-terrain altitude
	To disable this, set "LAND_TERR_UND" = -1
	To enable this,  set "LAND_TERR_UND" as the +/- terrain-altitude variations/undulations with respect to Home (in cm)
		Note: "LAND_TERR_UND" range is [-1,10000]cm. 
		      "LAND_TERR_UND" value is used here as Rangefinder failsafe. Therefore, whenever Rangefinder has issues, 
		  	  the vehicle descent speed reduces to "LAND_SPEED" if EKFAlt <= ("LAND_TERR_UND" + "LAND_ALT_LOW")cm
			  and reverts to normal functionality on Rangefinder recovery.


GA Copter 4.1.1 v3
------------------------------------------------------------------------------------------------------------
Functionality:
1. Disabling NPNT checks in SITL
2. Added advanced EKF logging,
	advanced EKF logging is controlled by "GA_DEBUG" parameter: 1 will switch it on, while 0 will turn it off.
3. Added mandatory arming check for Battery, i.e. vehicle will not be armed if
	Battery voltage is not available (or)
	Critical battery voltage is not defined (or)
	Battery voltage < Critical battery voltage
4. If EKF3 cores' Yaw-source is defined as GPS, then
	EKF3 cores are allowed to initialise only after obtaining a non-zero GPSyaw value.


GA Copter 4.1.1 v2
------------------------------------------------------------------------------------------------------------
Functionality:
1. Added versioning of GA builds

Controls:
1. Modified Loiter mode integrator initialization to fix its incorrect initialization in some cases that was
	causing overshoots in angle when taking off.
2. Resetting throttle_setting to fix AltHold mode initialization, which was causing overshoots when taking off.


GA Copter 4.1.1 v1 (baseline)
------------------------------------------------------------------------------------------------------------
Functionality:
1. NPNT arming check added to prevent arming without NPNT.
	Bit number 20 is NPNT check. Setting bit number 20 to 0 will disable NPNT checks and setting it 
	to 1 will enable NPNT checks. 
	(For internal use, user can override the check with changing ARMING_CHECK parameter.)
2. Handling VEL message from Trimble MB Two
3. MAVLink based Battery monitoring added to support CAN battery through IMX. 
	The parameter setting is 
	BATT_MONITOR = 21
		Note: Although this parameter’s option in Mission Planner mentions “21:INA2XX”, the code 
		corresponding to that is not available in this firmware version.
4. Following MAVLink messages added (in the MAVLink submodule currently linked to GA’s MAVLink repo):
	a. Message ID = 5000; Name = GA3A_PAYLOAD_STATUS
	b. Message ID = 5001; Name = GA3A_MISSION_CMD
	c. Message ID = 5002; Name = GA3A_RESUME_CMD
	d. Message ID = 6000; Name = NPNT_STATUS
	e. Message ID = 6001; Name = NPNT_REQ_LOGS
	f. Message ID = 6002; Name = NPNT_UIN_REGISTER
	g. Message ID = 6003; Name = NPNT_KEY_ROTATION
	h. Message ID = 6004; Name = NPNT_RFM_DETAIL
	i. Message ID = 6005; Name = NPNT_GEOFENCE
	j. Message ID = 7000; Name = GA_MAV_BATT_STATUS

Controls:
1. New frame types added: CA02 airframe and CA04-001 (CG Corrected) airframe
	a. CA02: FRAME_TYPE = 19
	b. CA04: FRAME_TYPE = 20
